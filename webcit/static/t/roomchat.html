<div id="chatrecv_history" class="chatrecv_history">
</div>
<div id="chatrecv" class="chatrecv">
</div>
<div id="chatsend" class="chatsend">
<form method="POST" onsubmit="return chatsendfunc()" action="chat_send" id="chatsendid" name="chatsendform">
<input type="hidden" name="nonce" value="<?NONCE>">
<img src="static/citadelchat_32x.gif">
<textarea maxlength="1024" id="send_this_id" name="send_this" wrap="soft" rows="5" cols="80"
 onKeyPress="chat_enter(event);"></textarea>
<input type="submit" value="<?_("Send")>">
</div>

<script type="text/javascript">

function chatsendfunc() {
	$('chatsendid').request({
		onComplete: function(){ $('send_this_id').value = '' }
	})
	return false;
}

function chat_enter(evt) {
	var charCode = (evt.which) ? evt.which : window.event.keyCode; 
	if (charCode == 13) {
		chatsendfunc();
	}
}

new Ajax.PeriodicalUpdater('chatrecv', 'chat_recv', {
	method: 'get', frequency: 2,
		onSuccess: function(){ 
			$('chatrecv_history').innerHTML =
				$('chatrecv_history').innerHTML + $('chatrecv').innerHTML;
			$('chatrecv').innerHTML = '';
			$('chatrecv_history').scrollTop = 9999999;
		}
});

</script>
